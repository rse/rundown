
#   derive image from a certain base image
FROM        node:22-alpine3.21

#   update Alpine and add additional tools
RUN         apk update && \
            apk upgrade

#   establish application area and user/group
RUN         mkdir -p /app && \
            apk add --no-cache --virtual .deps1 shadow && \
            groupadd -g 2000 app && \
            useradd -u 2000 -g app -d /app -m -s /bin/bash -p '!' -l app && \
            apk del .deps1 && \
            chown -R app:app /app
WORKDIR     /app
ENV         HOME=/app

#   install application
COPY        dst/rundown.js /app/

#   cleanup Alpine
RUN         rm -rf /var/cache/apk/*

#   provide entrypoint
WORKDIR     /app
ENTRYPOINT  [ "node", "--no-warnings", "rundown.js" ]
CMD         []

#   expose HTTP port
EXPOSE      8080

