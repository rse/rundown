##
##  Rundown - Render Rundown Scripts for Teleprompting
##  Copyright (c) 2023-2025 Dr. Ralf S. Engelschall <rse@engelschall.com>
##  Licensed under GPL 3.0 <https://spdx.org/licenses/GPL-3.0-only>
##

scripts:
    post-install: >
        npm --prefix rundown-lib install &&
        npm --prefix rundown-web install &&
        npm --prefix rundown-cli install &&
        npm --prefix rundown-dst install

    build: >
        npm --prefix rundown-lib start build &&
        npm --prefix rundown-web start build &&
        npm --prefix rundown-cli start build &&
        npm --prefix rundown-dst start build

    build:dev: |
        npm --prefix rundown-lib start build && \
        npm --prefix rundown-web start build && \
        npm --prefix rundown-cli start build:cmd
    build:dev:watch: |
        watch "npm start build:dev" \
            rundown-lib/src \
            rundown-web/src \
            rundown-cli/src \
            --wait=2 --interval=1
    run:dev:watch: |
        wait-on -l "rundown-cli/dst-stage2/rundown.js" && \
        cross-env NODE_OPTIONS="--no-warnings" \
            nodemon --signal SIGINT -w rundown-cli/dst-stage2 --delay 1500ms \
                rundown-cli/dst-stage2/rundown.js -- \
                $RUNDOWN_OPTIONS
    run:dev: |
        concurrently -p "[{name}]" -n "build,run" -c "blue,red" \
            "npm start build:dev:watch" \
            "npm start run:dev:watch"

    rundown-cmd: >
        node --no-warnings rundown-cli/dst-stage2/rundown.js \
            -o rundown-doc/rundown-template.html rundown-doc/rundown-template.docx
    rundown-web: >
        cross-env RUNDOWN_OPTIONS="-v info -a 127.0.0.1 -p 8888 -m web rundown-doc" \
            npm start run:dev
    rundown-web-ui: |
        cross-env RUNDOWN_OPTIONS="-v info -a 127.0.0.1 -p 8888 -m web-ui" \
            npm start run:dev

    publish: >
        npm --prefix rundown-dst start publish

    clean: >
        npm --prefix rundown-lib start clean &&
        npm --prefix rundown-web start clean &&
        npm --prefix rundown-cli start clean &&
        npm --prefix rundown-dst start clean

    clean-dist: >
        npm --prefix rundown-lib start clean-dist &&
        npm --prefix rundown-web start clean-dist &&
        npm --prefix rundown-cli start clean-dist &&
        npm --prefix rundown-dst start clean-dist

