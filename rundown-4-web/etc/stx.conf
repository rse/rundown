##
##  Rundown - Render Rundown Scripts for Teleprompting
##  Copyright (c) 2023-2025 Dr. Ralf S. Engelschall <rse@engelschall.com>
##  Licensed under GPL 3.0 <https://spdx.org/licenses/GPL-3.0-only>
##

#   [rundown-4-web] (internal): create patch set for NPM dependencies
patch-make
    npm shrinkwrap && \
    patch-package --patch-dir package.d \
        "@typescript-eslint/typescript-estree" \
        htmllint-cli && \
    shx rm -f npm-shrinkwrap.json

#   [rundown-4-web] (internal): apply patch set for NPM dependencies
patch-apply
    patch-package --patch-dir package.d

#   [rundown-4-web] static code analysis (continuous file watching)
lint-watch
    nodemon --exec "npm start lint" --watch src --ext html,styl,js,ts,vue

#   [rundown-4-web] static code analysis
lint
    vue-tsc --project etc/tsc-client.json --noEmit && \
    eslint --config etc/eslint.mjs src/**/*.vue src/**/*.ts && \
    stylelint --config etc/stylelint.yaml src/**/*.styl src/**/*.vue && \
    htmllint --rc etc/htmllint.json src/**/*.html

#   [rundown-4-web] build components for production
build : build-client

#   [rundown-4-web] build components for development
build:dev : build-client-dev

#   [rundown-4-web] build client components for production
build-client
    vite --config etc/vite-client.mts build --mode production

#   [rundown-4-web] build client components for development
build-client-dev
    vite --config etc/vite-client.mts build --mode development

#   [rundown-4-web] build client components for development (continuous file watching)
build-client-dev-watch
    cross-env NODE_OPTIONS="--max-old-space-size=4096" \
        vite --config etc/vite-client.mts build --mode development --watch

#   [rundown-4-web] run server
server
    serve -d --listen 12345 --single dst

#   [rundown-4-web] remove all development-only NPM dependencies
prune
    npm prune --omit=dev

#   [rundown-4-web] remove all generated artifacts (reverse of "npm start build")
clean
    shx rm -rf dst-stage1 dst-stage2

#   [rundown-4-web] remove all generated artifacts (reverse of "npm install" and "npm start build")
clean:dist : clean
    shx rm -f package-lock.json && \
    shx rm -rf node_modules

